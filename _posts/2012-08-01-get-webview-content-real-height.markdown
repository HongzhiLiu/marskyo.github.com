---
layout: post
title: "获取webview加载后的真实高度"
date: 2012-08-01 09:52
comments: true
tags: 
    - ios
---

在最近的需求中遇到一些比较复杂的页面布局，上有描述信息，下有无限加载的评论，中间有动态变化的webview.
我采用的方式是把这些组件全放入UITableView中，其中的难点主要是嵌入webview,因为tableview要求的是各cell的确定高度，而webview的加载是异步加载，其高度并不是那么容易获取。

我已经试过的方案是两种：

### 方法一
通过webview didfinishload方法来通知加载完成，这时webview应该把页面加载完成，肯定是得到了页面的高度，因为他也要设置scrollerview的contentSize的。

**优点**

这个非常稳定，都是取系统组件属性。

**缺点**

这个方法在页面有图时，有时取高度会少一点，这不知道为什么。

**代码实现**

{% gist 3225215 %}

### 方法二
通过js来获取实际页面的高度，获取的时机也通过js来监听。

**优点**

取到的值非常精确，不管有图还是无图。

**缺点**

多多少少我觉得执行js是一个取巧的方法。

**代码实现**

- 页面中添加js监听页面加载完成js

{% gist 3225261 %}

- webview中处理js回调，顺便用js把页面高度取出来

{% gist 3225282 %}
